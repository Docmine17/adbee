app-id: io.github.docmine17.adbee
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: adbee

finish-args:
  # Display
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  # Network for mDNS discovery
  - --share=network
  - --device=dri
  # Talk to host ADB daemon
  - --talk-name=org.freedesktop.Flatpak
  - --talk-name=org.freedesktop.portal.Desktop
  - --talk-name=org.freedesktop.portal.Background
  # Access to android-tools (adb)
  - --filesystem=~/.android:ro

modules:
  # ifaddr - dependency of zeroconf
  - name: python-ifaddr
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} ifaddr --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/9c/1f/19ebc343cc71a7ffa78f17018535adc5cbdd87afb31d7c34874680148b32/ifaddr-0.2.0-py3-none-any.whl
        sha256: 085e0305cfe6f16ab12d72e2024030f5d52674afad6911bb1eee207177b8a748

  # pypng - for QR code generation
  - name: python-pypng
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} pypng --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/3e/b9/3766cc361d93edb2ce81e2e1f87dd98f314d7d513877a342d31b30741680/pypng-0.20220715.0-py3-none-any.whl
        sha256: 4a43e969b8f5aaafb2a415536c1a8ec7e341cd6a3f957fd5b5f32a4cfeed902c

  # qrcode - QR code generation
  - name: python-qrcode
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} qrcode --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/dd/b8/d2d6d731733f51684bbf76bf34dab3b70a9148e8f2cef2bb544fccec681a/qrcode-8.2-py3-none-any.whl
        sha256: 16e64e0716c14960108e85d853062c9e8bba5ca8252c0b4d0231b9df4060ff4f

  # zeroconf - mDNS discovery
  - name: python-zeroconf
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} zeroconf --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/59/ff/c7372507c7e25ad3499fe08d4678deb1ed41c57f78ff5df43bd2d4d98cfc/zeroconf-0.148.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl
        sha256: cc88fd01b5552ffb4d5bc551d027ac28a1852c03ceab754d02bd0d5f04c54e85

  # ADB from host system via flatpak-spawn
  - name: adb-wrapper
    buildsystem: simple
    build-commands:
      - install -Dm755 adb-wrapper.sh ${FLATPAK_DEST}/bin/adb
    sources:
      - type: script
        dest-filename: adb-wrapper.sh
        commands:
          - exec flatpak-spawn --host adb "$@"

  # Main application
  - name: adbee
    buildsystem: meson
    sources:
      - type: dir
        path: .
